/*!

   VOD quality selector plugin for Flowplayer HTML5

   Copyright (c) 2016-2017, Flowplayer Drive Oy

   Released under the MIT License:
   http://www.opensource.org/licenses/mit-license.php

   Requires Flowplayer HTML5 version 7.x or greater
   v1.0.0-11-g42e6c99

*/
!function(){var e=function(e){function t(t,i){return!!e.engines.filter(function(e){return e.canPlay(t,i)})[0]}e(function(i){var l=e.support;if(l.inlineVideo){var s=/(-[0-9]+p)?(\.(mp4|webm|m3u8|ogv|flv|f4v)?)$/i,a=/(\.(mp4|webm|m3u8|ogv|flv|f4v))?$/i,r=/\.?{ext}/,o=/^(https?:)?\/\/[^\/]+\//,u=!1;i.conf.hlsjs!==!1&&e.engines.forEach(function(e){"hlsjs"===e.engineName&&e.canPlay("application/x-mpegurl",i.conf)&&(u=!0)}),i.on("load",function(e,i,u){if(!i.live){var n=i.conf,c=u.vodQualities||n.vodQualities||{},p=!(!u.qualities&&!n.qualities||!u.defaultQuality&&!n.defaultQuality);if(p){var f=u.originalQualities=u.originalQualities||u.qualities||n.qualities,y=u.defaultQuality||n.defaultQuality,v=u.src.replace(s,"-{q}.{ext}");"string"==typeof f&&(f=f.split(","));var d=(("string"==typeof c.qualities?c.qualities.split(","):c.qualities)||f||[]).map(function(e){return e!==y?e:{label:e,src:v.replace(/-{q}/,"")}});c={template:v,qualities:d}}if(c&&c.qualities&&c.qualities.length){u.hlsQualities=!1;var m,q={},g=u.sources.filter(function(e){return!/mpegurl/i.test(e.type)&&t(e.type,n)})[0],h=g&&a.exec(g.src)[0],Q=u.sources.some(function(e){return/mpegurl/i.test(e.type)?(q[-1]={type:e.type,src:e.src},!0):!1}),j="video/flash";if(u.sources.forEach(function(e){e.type===j&&(m=e.src)}),(l.video||m)&&(!m||(n.rtmp||u.rtmp)&&!/^(https?:)?\/\//.test(m))){var b=Q?[{value:-1,label:"Auto"}]:[],w=m&&/^(mp4|flv):/.test(m)&&m.slice(0,4)||"";b=b.concat(c.qualities.map(function(e,t){return"string"==typeof e?(q[t]={type:g&&g.type,src:g&&g.type!==j?c.template.replace("{q}",e).replace(r,h):c.template.replace(o,w).replace("{q}",e).replace(r,h)},{value:t,label:e}):(q[t]={type:e.type||g&&g.type,src:e.type&&e.type!==j||g&&g.type!==j?e.src.replace(r,h):e.src.replace(o,w).replace(r,h)},{value:t,label:e.label})})),u.qualities=b,u.quality=/mpegurl/i.test(u.type)?-1:Object.keys(q).filter(function(e){return u.src.indexOf(q[e].src)>-1})[0],u.vodQualitySources=q}}}}),i.on("quality",function(t,i,l){var s=i.video.vodQualitySources&&i.video.vodQualitySources[l];if(s){var a=i.video.originalSources||i.video.sources,r=e.extend,o=r({},i.video,{originalSources:a,sources:[{type:s.type,src:s.src}].concat(a),src:null,type:null}),n=o.time;u&&o.hlsjs!==!1&&n&&0>l&&(o.hlsjs=r(o.hlsjs||{},{startPosition:n})),i.load(o,function(e,t){t.finished=!1,!n||o.hlsjs&&o.hlsjs.startPosition?o.hlsjs&&(o.hlsjs.startPosition=0):t.seek(n,function(){t.resume()})})}})}})};"object"==typeof module&&module.exports?module.exports=e:"function"==typeof window.flowplayer&&e(window.flowplayer)}();
